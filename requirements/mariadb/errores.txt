1ï¸âƒ£ Why your current Dockerfile fails

ENTRYPOINT ["mariadb"]

mariadb is the client, not the server.

Thatâ€™s why when you run the container, thereâ€™s no server running â†’ the socket /run/mysqld/mysqld.sock doesnâ€™t exist â†’ you get ERROR 2002 (HY000).

You need to start mysqld, the server, instead.



2.  Por que no lanzar el servidor de mariadb y el cliente de mariadb a la vez en el container:

In a container, you generally want only the server running, because:

- The container itself is meant to be the database service.

- Other programs (WordPress, Adminer, or docker exec â€¦ mariadb) will connect to it when needed.

- If you try to launch both server + client in one container, one of them has to stay in the foreground as PID 1 â€” but only one process can be the containerâ€™s â€œmain processâ€.

You could technically script it (like mysqld & mariadb -u root) but:

- It goes against Docker best practices (one main service per container).

- The client would just sit there waiting for input, serving no real purpose.

- It makes your container harder to manage.


3. Al intentar exectar mariadb con un usuario no root despues de haber hecho docker compose up, no tenia permiso para exejutar mariadb(cliente) hasta que en el script he anadido una inicializacion: "mariadb -u root <<-EOSQL
  CREATE DATABASE IF NOT EXISTS ${MYSQL_DATABASE};
  CREATE USER IF NOT EXISTS '${MYSQL_USER}'@'%' IDENTIFIED BY '${MYSQL_PASSWORD}';
  GRANT ALL PRIVILEGES ON ${MYSQL_DATABASE}.* TO '${MYSQL_USER}'@'%';
  FLUSH PRIVILEGES;
EOSQL

"

4. como solo podemos correr un solo proceso en el container, cuando queremos crear una tabla en mariadb, necesitamos un usuario que se conecte como cliente(mariadb) al servidor (mysqld) y eso ya es un proceso, osea que lo hqcemos de manera temporal antes de lanzar el proceso real (PID 1) del contenedor. POr eso tenemos cosas como : "mysqladmin -u root shutdown" en el .sh.

5. passwords
# esta copia de el .env con las contrasenas esta prohibido por subject
# â€œPasswords must not be present in your Dockerfiles.â€
# ademas, aunque lo haga, si creo la imagen con: "docker build -t inception-db srcs/mariadb" desde la carpeta de inception, tampoco me va a dejar copiar el .env por razones de seguridad, porque le he especificado que el build localtion seria la carpeta 'mariadb' y en esa el .env no existe.
COPY ../../.env /root/.env

6. no estaba cambiando la configuracion de mariadb para que pueda conectarse con cualquier ip. Solo me podia conectar conmmigo misma (localhost). Esta configuracion esta en /etc/mysql/mariadb.conf.d/50-server.cnf. He cambiado la linea de:
bind-address = 127.0.0.1, a: bind-address = 0.0.0.0. Con esto el contendor de wordpress puede econtrarme.
este cambio lo he anadido al script asi:

echo "ğŸ› ï¸ Configuring MariaDB bind-address..."
cat > /etc/mysql/mariadb.conf.d/99-bind.cnf <<EOF
[mysqld]
bind-address = 0.0.0.0
EOF
echo "âœ… bind-address set to 0.0.0.0"
